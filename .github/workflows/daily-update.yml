name: Daily Profile Update

on:
  schedule:
    - cron: "0 0 * * *" # ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ø¨Ù„ÙŠÙ„
  workflow_dispatch:

jobs:
  update-content:
    runs-on: ubuntu-latest
    name: Update Quote & WakaTime

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # ğŸ”´ Ù…Ù‡Ù… Ø¹Ù„Ø´Ø§Ù† rebase ÙŠØ´ØªØºÙ„ ØµØ­

      # ğŸ”´ Node Ù„Ø§Ø²Ù… ÙŠØªØ¸Ø¨Ø· ØµØ±Ø§Ø­Ø©
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # 1ï¸âƒ£ ØªØ­Ø¯ÙŠØ« WakaTime
      - name: Update WakaTime Stats
        uses: athul/waka-readme@master
        with:
          WAKATIME_API_KEY: ${{ secrets.WAKATIME_API_KEY }}
          SECTION_NAME: waka
          TIME_RANGE: all_time
          LANG_COUNT: 30

      # 2ï¸âƒ£ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚ÙˆÙ„Ø© (ÙƒÙˆØª + Ù„ÙˆÙ† + log)
      - name: Update Daily Quote
        run: node scripts/update-quote.js

      # 3ï¸âƒ£ Commit & Push (Ù…Ù„ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©)
      - name: Commit & Push
        run: |
          git config user.name "Mohamed Abdelwahab"
          git config user.email "mohamedabdelwahabelazab@gmail.com"

          git add README.md data/*.json

          if ! git diff --cached --quiet; then
            git commit -m "chore: update daily quote & wakatime stats"
            git pull --rebase origin main
            git push origin main
          else
            echo "No changes to commit"
          fi

